<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Metadata -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Eco-Resilience Match-Up</title>

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">

        <!-- CSS -->
        <style>
            :root {
              --blue: rgb(92, 113, 242);
              --blue-dark: rgb(51, 56, 118);
              --blue-light: rgb(162, 169, 242);
              --gray: rgb(197, 197, 197);
              --gray-dark: rgb(124, 124, 124);
              --gray-light: rgb(237, 237, 237);
              --off-black: rgb(36, 36, 36);
              --off-white: rgb(242, 242, 242);
              --teal: rgb(134, 213, 224);
              --teal-dark: rgb(100, 160, 168);
              --teal-light: rgb(204, 238, 242);
            }

            body {
              background-color: var(--off-white);
              font-family: "Poppins", sans-serif;
            }


            .button-blue {
              --button-color: white;
              --button-background-color: var(--blue);
              --button-border-color: var(--blue-dark);
              --button-hover-background-color: var(--blue-dark);
            }

            .button-dark {
              --button-color: white;
              --button-background-color: var(--off-black);
              --button-border-color: black;
              --button-hover-background-color: black;
            }

            .button-light {
              --button-color: black;
              --button-background-color: var(--gray-light);
              --button-border-color: var(--gray-dark);
              --button-hover-background-color: var(--gray);
            }

            .button-teal {
              --button-color: black;
              --button-background-color: var(--teal);
              --button-border-color: var(--teal-dark);
              --button-hover-background-color: var(--teal-dark);
            }

            h1, h2, h3, h4, h5, h6 {
              font-weight: 600;
              line-height: 1.2;
              margin-bottom: .5rem;
              margin-top: 0;
            }




            /* Adrian's CSS */
            .container {
                max-width: 960px;
                margin: auto;
                padding: 20px;

            }

            h1 {
              margin-top: 30px;
            }

            h1, h3, p {
                text-align: center;
                
            }

            p {
                margin-bottom: 20px;
            }

            h3 {
                margin-top: 20px;
            }

            main {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }


            .draggable-list {
                padding: 5px;
                --block-container-border-color: var(--off-black);
                background-color: var(--off-white);
                border: .2em solid var(--gray-light);
                border-radius: .4em;
                margin: .2em 0em;
                padding: 1em 1em 0em 1em;
                width: auto;
            }

            .block-container {
                margin: 10px;
                padding: 10px;
                border: .2em solid var(--gray-light);
                border-radius: .4em;
                background-color: var(--off-white);
            }

            li {
                list-style: none;
                padding: 10px;
                margin: 5px;
                background-color: rgb(162, 169, 242);
                color: #263238;
                cursor: grab;
                border-radius: .4em;
                border: .2em solid var(--gray-light); /* border color */
            }

            li:hover {
                border: 1px solid rgb(197, 197, 197) !important;
                cursor: grabbing !important;
                transition: background-color 0.3s ease-in-out;
                transition: color 0.3s ease-in-out;
                transition: border 0.3s ease-in-out;
                transition: cursor 0.3s ease-in-out;
                transition: transform 0.3s ease-in-out;
                transform: scale(1.05);
            }


            .over {
                background-color: rgb(197, 197, 197) !important;
                color: white !important;
                border: 1px solid rgb(197, 197, 197) !important;
            }

            table {
                max-width: 640px;
                margin: auto;
                margin-bottom: 20px;
            }

            th, td{
                padding: 10px 10px;
            }

            td {
                border: .2em solid var(--gray-light);
                border-radius: .4em;
            }

            tr:nth-child(even) {
                background-color: rgb(197, 197, 197);
            }

            .playAgain {
                --reset-border-color: var(--blue);
                height: 3em;
                border-radius: 1.5em;
                font-family: inherit;
                border: none;
                background-color: var(--blue);
                color: white;
                padding: 0em 3em;
                transition: background-color .15s ease-in-out, border .15s ease-in-out;
                display: block;
                margin: auto;
                margin-top: 20px;
                cursor: pointer;
            }

            .playAgain:hover {
                border: .2em solid var(--reset-border-color) !important;
            }

            .playAgain:active {
                --reset-border-color: var(--blue-dark);
                background-color: var(--blue-dark);
            }

            #endMessage {
                display: none;
            }

            #hintMessage {
                text-align: center;
                color: red;
                margin-top: 20px;
                font-weight: bold;
            } 

        </style>

    </head>
    <body>
        <h1> Eco-Resilience Match-Up</h1>
        <h3>Drag and Drop to match the eco-friendly solution on the LEFT with the hazard it will defend against on the RIGHT</h3>
        <canvas id="confettiCanvas" style="position: fixed; top: 0; left: 0; pointer-events: none;"></canvas>
        <main class="container">
            <div class="block-container">
                <h3>Eco-Solutions</h3>
                <ul class="draggable-list">
                    <li id="e1" draggable="true">Fire-Resistant Building Materials</li>
                    <li id="e2" draggable="true">Sandbags</li>
                    <li id="e3" draggable="true">Strong Roofs</li>
                    <li id="e4" draggable="true">Shock-Absorbing Foundation</li>
                    <li id="e5" draggable="true">Lightning Rod</li>
                </ul>
            </div>
            <div class="block-container">
                <h3>Hazard Types</h3>
                <ul class="draggable-list">
                    <li id="f4" draggable="true">Earthquake</li>
                    <li id="f1" draggable="true">Fire</li>
                    <li id="f2" draggable="true">Flooding</li>
                    <li id="f3" draggable="true">Strong Winds</li>
                    <li id="f5" draggable="true">Lightning</li>
                </ul>
            </div>
        </main>
        <div id="hintMessage" style="display: none;"></div>
        <div id="endMessage">
            <h3>Great job!</h3>
            <h3>You matched all the tiles correctly!</h3>
            <table>
                <tr>
                    <th>Eco-Solution</th>
                    <th>Hazard Type</th>
                </tr>
                <tr>
                    <td>Flooding</td>
                    <td>Sandbags</td>
                </tr>
                <tr>
                    <td>Strong Winds</td>
                    <td>Strong Roofs</td>
                </tr>
                <tr>
                    <td>Earthquake</td>
                    <td>Shock absorbing Foundation</td>
                </tr>
                <tr>
                    <td>Fire</td>
                    <td>Fire Resistant Building Materials</td>
                </tr>
                <tr>
                  <td>Lightning</td>
                  <td>Lightning Rod</td>
              </tr>
            </table>

            <button class="playAgain" id="playAgainBtn">Play Again</button>
        </div>

        <script>
          let selectedId;
          let dropTargetId;
          let matchingCounter = 0;
      
          document.addEventListener('DOMContentLoaded', () => {
              const endMessage = document.getElementById('endMessage');
              const hintMessage = document.getElementById('hintMessage');
              const playAgainBtn = document.getElementById('playAgainBtn');
              const correctSound = new Audio('correct.mp3');
                const swapSound = new Audio('swap.mp3'); 
      
              function addEventListeners() {
                  const draggableListItems = document.querySelectorAll('.draggable-list li');
                  draggableListItems.forEach(item => {
                      item.addEventListener('dragstart', dragStart);
                      item.addEventListener('dragenter', dragEnter);
                      item.addEventListener('dragover', dragOver);
                      item.addEventListener('dragleave', dragLeave);
                      item.addEventListener('drop', dragDrop);
                  });
              }
      
              function dragStart() { selectedId = this.id; }
              function dragEnter() { this.classList.add('over'); }
              function dragLeave() { this.classList.remove('over'); }
              function dragOver(ev) { ev.preventDefault(); }
              
              function dragDrop() {
                  dropTargetId = this.id;
                  swapSound.play(); // Play sound when tiles are swapped
                  if (checkForMatch(selectedId, dropTargetId)) {
                      document.getElementById(selectedId).style.backgroundColor = 'green';
                      document.getElementById(dropTargetId).style.backgroundColor = 'green';
                      document.getElementById(selectedId).setAttribute('draggable', false);
                      document.getElementById(dropTargetId).setAttribute('draggable', false);
                      matchingCounter++;

                      if (matchingCounter === 5) {
                        triggerConfetti(); // Trigger confetti when all tiles are matched
                        correctSound.play(); // Play sound when all tiles are matched
                        setTimeout(() => endMessage.style.display = 'block', 500);
                      }
                  } else {
                      let hint = getHint(selectedId, dropTargetId);
                      hintMessage.innerText = `Incorrect match. ${hint}`;
                      hintMessage.style.display = 'block';
                      setTimeout(() => hintMessage.style.display = 'none', 8000);
                  }
                  this.classList.remove('over');
              }
      
              function checkForMatch(selected, dropTarget) {
                  const pairs = { 'e1': 'f1', 'e2': 'f2', 'e3': 'f3', 'e4': 'f4', 'e5':'f5' };
                  return pairs[selected] === dropTarget;
              }
      
              function getHint(selected, dropTarget) {
                  const hints = {
                      'e1': 'Sandbags are great at absorbing water!',
                      'e2': 'Tornado winds are strong enough to blow the roof off a house!',
                      'e3': 'Buildings need to be built strong enough to withstand earthquakes!',
                      'e4': 'Some buildings can withstand fire because of the kind of materials they are build with.',
                      'e5': 'Buildings need something to absorb lightning strikes'
                  };
                  return hints[selected] || 'Try matching related energy types and features.';
              }

              // Set up the confetti canvas
                const confettiCanvas = document.getElementById('confettiCanvas');
                confettiCanvas.width = window.innerWidth;
                confettiCanvas.height = window.innerHeight;
                const ctx = confettiCanvas.getContext('2d');
                let confettiParticles = [];

                function triggerConfetti() {
                // Resize the canvas (useful if the window size changed)
                confettiCanvas.width = window.innerWidth;
                confettiCanvas.height = window.innerHeight;
                // Create 300 confetti particles with random properties
                for (let i = 0; i < 300; i++) {
                    confettiParticles.push({
                    x: Math.random() * confettiCanvas.width,
                    y: Math.random() * confettiCanvas.height,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 5 + 2,
                    speed: Math.random() * 3 + 1,
                    });
                }
                drawConfetti();
                }

                function drawConfetti() {
                ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                confettiParticles.forEach((particle, i) => {
                    ctx.fillStyle = particle.color;
                    ctx.fillRect(particle.x, particle.y, particle.size, particle.size);
                    particle.y += particle.speed;
                    // Remove particles that fall below the canvas
                    if (particle.y > confettiCanvas.height) confettiParticles.splice(i, 1);
                });
                if (confettiParticles.length > 0) {
                    requestAnimationFrame(drawConfetti);
                }
                }

      // Shuffle the tiles with every playthrough
            function shuffleTiles() {
                const lists = document.querySelectorAll('.draggable-list');
                lists.forEach(list => {
                    let items = Array.from(list.children);
                    for (let i = items.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [items[i], items[j]] = [items[j], items[i]];
                      }
                      list.innerHTML = '';
                      items.forEach(item => list.appendChild(item));
                  });
              }
      
              function playAgain() {
                  document.getElementById('endMessage').style.display = 'none';
                  matchingCounter = 0;
      
                  const allItems = document.querySelectorAll('.draggable-list li');
                  allItems.forEach(item => {
                      item.style.backgroundColor = 'rgb(162, 169, 242)';
                      item.setAttribute('draggable', true);
                  });
      
                  shuffleTiles();

                  draggableListItems = document.querySelectorAll('.draggable-list li');  // Refresh the node list
                  addEventListeners(); // Re-add event listeners after shuffling
              }
              playAgainBtn.addEventListener('click', playAgain);
      
              addEventListeners();
          });
      </script>

  </body>
</html>
